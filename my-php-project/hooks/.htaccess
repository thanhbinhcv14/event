# Allow direct access to webhook files
# This ensures webhook endpoints can be accessed from external services

<Files "*.php">
    Order allow,deny
    Allow from all
</Files>

# Disable directory listing
Options -Indexes

# Allow POST requests (required for webhooks)
<Limit POST>
    Order allow,deny
    Allow from all
</Limit>

# ✅ QUAN TRỌNG: Đảm bảo Authorization header được pass qua đúng cách
# Một số server (đặc biệt là Apache) có thể không pass Authorization header mặc định
# Cần enable mod_rewrite và setenvif để pass header này

# Phương pháp 1: Set environment variable từ Authorization header (nếu mod_setenvif có sẵn)
<IfModule mod_setenvif.c>
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
    SetEnvIf Authorization "(.+)" HTTP_AUTHORIZATION=$1
</IfModule>

# Phương pháp 2: Dùng mod_rewrite để pass Authorization header (nếu mod_rewrite có sẵn)
<IfModule mod_rewrite.c>
    RewriteEngine On
    # Pass Authorization header từ HTTP header vào $_SERVER
    RewriteCond %{HTTP:Authorization} ^(.+)$
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
    # Hoặc dùng REDIRECT_HTTP_AUTHORIZATION
    RewriteCond %{HTTP:Authorization} ^(.+)$
    RewriteRule .* - [E=REDIRECT_HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

# Phương pháp 3: Cho phép Authorization header trong Apache
<IfModule mod_headers.c>
    # Đảm bảo Authorization header được giữ lại
    RequestHeader set Authorization %{HTTP:Authorization}e env=HTTP_AUTHORIZATION
</IfModule>

